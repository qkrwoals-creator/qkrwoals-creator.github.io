<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìë¦¬ ë°°ì • í”„ë¡œê·¸ë¨</title>
<style>
body {
  font-family: 'Pretendard','Noto Sans KR',sans-serif;
  margin:0;
  background: linear-gradient(135deg,#3b82f6,#93c5fd);
  color:#1e3a8a;
  min-height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
}
header {
  position:sticky;
  top:0;
  width:100%;
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(10px);
  color: #1e3a8a;
  text-align:center;
  padding:15px 0;
  font-weight:700;
  font-size:1.5rem;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
  z-index:10;
}
main {
  background: rgba(255,255,255,0.7);
  backdrop-filter: blur(15px);
  border-radius:20px;
  box-shadow:0 5px 25px rgba(0,0,0,0.2);
  width:90%;
  max-width:900px;
  padding:30px;
  margin:40px 0;
}
h2 { color: #1d4ed8; }
input, textarea {
  border:none;
  border-radius:10px;
  padding:12px;
  width:80%;
  max-width:400px;
  margin:8px 0;
  font-size:1rem;
  background: rgba(255,255,255,0.9);
  box-shadow:0 1px 4px rgba(0,0,0,0.1);
  outline:none;
  transition:0.3s;
}
input:focus, textarea:focus {
  box-shadow:0 0 6px rgba(59,130,246,0.8);
}
button {
  background: linear-gradient(135deg, #2563eb, #1d4ed8);
  color:white;
  border:none;
  border-radius:8px;
  padding:10px 16px;
  margin:6px;
  cursor:pointer;
  font-weight:600;
  transition:0.25s ease;
  box-shadow:0 3px 10px rgba(37,99,235,0.3);
}
button:hover {
  background: linear-gradient(135deg,#1e40af,#2563eb);
  transform: translateY(-2px);
  box-shadow:0 5px 15px rgba(37,99,235,0.4);
}
#classroom {
  margin-top:20px;
  font-weight:600;
  color:#1e3a8a;
  min-height:200px;
  line-height:1.8;
  font-size:1rem;
  white-space:pre; /* ê³µë°± ìœ ì§€ */
}
.seat {
  display:inline-block;
  padding:5px 10px;
  border-radius:8px;
  background: rgba(255,255,255,0.85);
  margin:2px;
  cursor:grab;
}
.seat.dragging { opacity:0.5; background: #bfdbfe; }
footer { text-align:center; color:#f0f9ff; margin-bottom:30px; }
#info { color:#475569; margin-top:10px; font-size:0.9rem; min-height:20px; }
#vote-section { margin-top:20px; display:none; }
</style>
</head>
<body>
<header>ğŸ’ ìë¦¬ ë°°ì • í”„ë¡œê·¸ë¨</header>
<main>
<section id="login-section">
  <h2>ë¡œê·¸ì¸</h2>
  <input type="text" id="username" placeholder="ì´ë¦„ ë˜ëŠ” í•™ë²ˆ ì…ë ¥"><br>
  <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"><br>
  <button onclick="login()">ë¡œê·¸ì¸</button>
</section>

<section id="seat-section" style="display:none;">
  <h2 id="welcome"></h2>
  <h3>í•™ìƒ ëª©ë¡ ì…ë ¥ / CSV ì—…ë¡œë“œ</h3>
  <textarea id="studentList" rows="5" placeholder="í•™ìƒ ì´ë¦„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥"></textarea><br>
  <input type="file" id="csvFile" accept=".csv"><button onclick="loadCSV()">CSV ì—…ë¡œë“œ</button><br>

  <h3>ìë¦¬ ë°°ì¹˜ í–‰ x ì—´ ì„¤ì •</h3>
  <input type="number" id="rows" placeholder="í–‰ ìˆ˜" min="1" style="width:35%;"> x 
  <input type="number" id="cols" placeholder="ì—´ ìˆ˜" min="1" style="width:35%;"><br>

  <button onclick="createSeats()">ìë¦¬ ë§Œë“¤ê¸° ğŸª‘</button>
  <button onclick="shuffleWithAnimation()">ìë¦¬ ì„ê¸° ğŸ²</button>
  <button onclick="exportImage()">PNG ì €ì¥ ğŸ“¸</button>
  <button onclick="resetSeats()">ì´ˆê¸°í™” ğŸ”„</button>

  <div id="classroom"></div>
  <div id="info"></div>

  <div id="vote-section">
    <h3>ìë¦¬í‘œë¥¼ ìŠ¹ì¸í• ê¹Œìš”?</h3>
    <button onclick="vote(true)">ì°¬ì„± ğŸ‘</button>
    <button onclick="vote(false)">ë°˜ëŒ€ ğŸ‘</button>
    <div id="vote-info"></div>
  </div>
</section>
</main>
<footer>Â© 2025 ìë¦¬ ë°°ì • ì‹œìŠ¤í…œ</footer>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
let loggedInUser=null;
let students=[];
let seats=[];
let votes={};
let voteSection=document.getElementById("vote-section");

// ë¡œê·¸ì¸
function login(){
  const name = document.getElementById("username").value.trim();
  const pw = document.getElementById("password").value;
  if(!name || !pw) return alert("ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”!");

  const savedPw = localStorage.getItem(`pw_${name}`);
  if(savedPw){
    if(savedPw !== pw) return alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤!");
  } else {
    localStorage.setItem(`pw_${name}`, pw);
  }

  loggedInUser = name;
  document.getElementById("login-section").style.display = "none";
  document.getElementById("seat-section").style.display = "block";
  document.getElementById("welcome").innerText = `${name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‘‹`;
  loadSeats();
}

// CSV ì—…ë¡œë“œ
function loadCSV(){
  const file=document.getElementById("csvFile").files[0];
  if(!file) return alert("íŒŒì¼ ì„ íƒ í•„ìš”");
  const reader=new FileReader();
  reader.onload=function(e){
    const text=e.target.result;
    students=text.split("\n").map(s=>s.trim()).filter(s=>s);
    document.getElementById("studentList").value=students.join("\n");
    updateInfo(`${students.length}ëª…ì˜ í•™ìƒ ëª©ë¡ ë¡œë“œ âœ…`);
  };
  reader.readAsText(file,"UTF-8");
}

// ìë¦¬ ìƒì„±
function createSeats(){
  const list=document.getElementById("studentList").value.trim();
  const rows=parseInt(document.getElementById("rows").value);
  const cols=parseInt(document.getElementById("cols").value);

  if(!list) return alert("í•™ìƒ ëª©ë¡ì„ ì…ë ¥í•˜ì„¸ìš”!");
  if(!rows || !cols) return alert("í–‰ê³¼ ì—´ì„ ì…ë ¥í•˜ì„¸ìš”!");
  students=list.split("\n").map(s=>s.trim()).filter(s=>s);

  if(rows*cols < students.length){
    return alert(`í–‰ x ì—´ì´ í•™ìƒ ìˆ˜ë³´ë‹¤ ì‘ìŠµë‹ˆë‹¤! í•™ìƒ: ${students.length}, ìë¦¬: ${rows*cols}`);
  }

  generateSeats(students, rows, cols);
  updateInfo(`ì´ ${students.length}ëª…ì˜ í•™ìƒ, ${rows}í–‰ x ${cols}ì—´ë¡œ ìë¦¬ ìƒì„± âœ…`);
}

// ìë¦¬ í‘œì‹œ
function generateSeats(names, rows, cols){
  const container=document.getElementById("classroom");
  container.innerHTML="";
  seats=[];

  let idx=0;
  for(let r=0;r<rows;r++){
    let line="";
    for(let c=0;c<cols;c++){
      const seatName = names[idx] || "ë¹ˆìë¦¬";
      const span=document.createElement("span");
      span.classList.add("seat");
      span.textContent = seatName;

      // ë“œë˜ê·¸ ì´ë²¤íŠ¸
      span.draggable=true;
      span.addEventListener("dragstart",e=>{span.classList.add("dragging"); e.dataTransfer.setData("text/plain","");});
      span.addEventListener("dragend",e=>{span.classList.remove("dragging"); saveSeats();});
      span.addEventListener("dragover",e=>e.preventDefault());
      span.addEventListener("drop",e=>{
        const dragging=document.querySelector(".dragging");
        if(dragging && dragging!==span){
          [span.textContent, dragging.textContent]=[dragging.textContent, span.textContent];
          saveSeats();
        }
      });

      seats.push(span);
      line += seatName + "â€ƒ";
      idx++;
    }
    container.innerHTML += line + "<br>";
  }

  votes={};
  voteSection.style.display="none";
}

// ìë¦¬ ì„ê¸° ì• ë‹ˆë©”ì´ì…˜
function shuffleWithAnimation(){
  if(seats.length===0) return;
  let iterations=5;
  let count=0;
  const info=document.getElementById("info");
  const interval=setInterval(()=>{
    for(let s of seats){
      s.textContent=students[Math.floor(Math.random()*students.length)] || "ë¹ˆìë¦¬";
    }
    info.innerText=["ì–´ë–»ê²Œ ë ê¹Œìš”? ğŸ¤”","ì ê¹ë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” â³","ì¡°ê¸ˆë§Œ ë”..."][count%3];
    count++;
    if(count>=iterations){
      clearInterval(interval);
      voteSection.style.display="block";
      updateInfo("ìë¦¬ ì„ê¸° ì™„ë£Œ! ìŠ¹ì¸ íˆ¬í‘œë¥¼ ì§„í–‰í•˜ì„¸ìš” âœ…");
    }
  },400);
}

// íˆ¬í‘œ
function vote(choice){
  votes[loggedInUser]=choice;
  const allVotes=Object.values(votes);
  const approveCount=allVotes.filter(v=>v===true).length;
  const needed=Math.ceil(Object.keys(votes).length/2) || 1;

  document.getElementById("vote-info").innerText=`ì°¬ì„± ${approveCount} / í•„ìš” ${needed}ëª…`;

  if(approveCount>=needed){
    voteSection.style.display="none";
    saveSeats();
    updateInfo("ê³¼ë°˜ìˆ˜ ìŠ¹ì¸ ì™„ë£Œ! ìë¦¬ í™•ì • âœ…");
  } else {
    updateInfo("ê³¼ë°˜ìˆ˜ ë¯¸ë‹¬, ë‹¤ì‹œ ì„ìŠµë‹ˆë‹¤ ğŸ”„");
    shuffleWithAnimation();
  }
}

// ì €ì¥ & ë¶ˆëŸ¬ì˜¤ê¸°
function saveSeats(){
  if(!loggedInUser) return;
  localStorage.setItem(`students_${loggedInUser}`, students.join("\n"));
  localStorage.setItem(`grid_${loggedInUser}`, JSON.stringify({rows:document.getElementById("rows").value, cols:document.getElementById("cols").value}));
  localStorage.setItem(`seats_${loggedInUser}`, JSON.stringify(seats.map(s=>s.textContent)));
}

function loadSeats(){
  if(!loggedInUser) return;
  const savedSeats=JSON.parse(localStorage.getItem(`seats_${loggedInUser}`)||"[]");
  const savedStudents=localStorage.getItem(`students_${loggedInUser}`)||"";
  const savedGrid=JSON.parse(localStorage.getItem(`grid_${loggedInUser}`)||"{}");

  if(savedStudents) document.getElementById("studentList").value=savedStudents;
  if(savedGrid.rows) document.getElementById("rows").value=savedGrid.rows;
  if(savedGrid.cols) document.getElementById("cols").value=savedGrid.cols;

  if(savedSeats.length>0){
    students=savedSeats.filter(s=>s!=="ë¹ˆìë¦¬");
    generateSeats(students, savedGrid.rows, savedGrid.cols);
    updateInfo("ì´ì „ ìë¦¬ ë°°ì¹˜ ë¶ˆëŸ¬ì˜¤ê¸° âœ…");
  }
}

// ìƒíƒœ í‘œì‹œ
function updateInfo(msg){ document.getElementById("info").innerText=msg; }

// PNG ì €ì¥
function exportImage(){
  html2canvas(document.getElementById("classroom")).then(canvas=>{
    const link=document.createElement("a");
    link.download="seats.png";
    link.href=canvas.toDataURL();
    link.click();
  });
}

// ì´ˆê¸°í™”
function resetSeats(){
  students=[];
  seats=[];
  votes={};
  document.getElementById("classroom").innerHTML="";
  document.getElementById("studentList").value="";
  document.getElementById("rows").value="";
  document.getElementById("cols").value="";
  voteSection.style.display="none";
  updateInfo("ì´ˆê¸°í™” ì™„ë£Œ ğŸ”„");
}
</script>
</body>
</html>
