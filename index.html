<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ìë¦¬ ë°°ì • í”„ë¡œê·¸ë¨</title>
<style>
  body { font-family: 'Pretendard','Noto Sans KR',sans-serif; margin:0; background: linear-gradient(135deg,#3b82f6,#93c5fd); color:#1e3a8a; min-height:100vh; display:flex; flex-direction:column; align-items:center; }
  header { position:sticky; top:0; width:100%; background: rgba(255,255,255,0.25); backdrop-filter: blur(10px); color: #1e3a8a; text-align:center; padding:15px 0; font-weight:700; font-size:1.5rem; box-shadow:0 2px 8px rgba(0,0,0,0.15); z-index:10; }
  main { background: rgba(255,255,255,0.7); backdrop-filter: blur(15px); border-radius:20px; box-shadow:0 5px 25px rgba(0,0,0,0.2); width:90%; max-width:900px; padding:30px; margin:40px 0; }
  h2 { color: #1d4ed8; }
  input, textarea { border:none; border-radius:10px; padding:12px; width:80%; max-width:400px; margin:8px 0; font-size:1rem; background: rgba(255,255,255,0.9); box-shadow:0 1px 4px rgba(0,0,0,0.1); outline:none; transition:0.3s; }
  input:focus, textarea:focus { box-shadow:0 0 6px rgba(59,130,246,0.8); }
  button { background: linear-gradient(135deg, #2563eb, #1d4ed8); color:white; border:none; border-radius:8px; padding:10px 16px; margin:6px; cursor:pointer; font-weight:600; transition:0.25s ease; box-shadow:0 3px 10px rgba(37,99,235,0.3); }
  button:hover { background: linear-gradient(135deg,#1e40af,#2563eb); transform: translateY(-2px); box-shadow:0 5px 15px rgba(37,99,235,0.4); }
  #classroom { display:grid; gap:10px; margin-top:20px; }
  .seat { background: rgba(255,255,255,0.85); border-radius:12px; height:80px; display:flex; align-items:center; justify-content:center; font-weight:600; color:#1e3a8a; box-shadow:0 2px 6px rgba(0,0,0,0.1); transition: all 0.25s ease; cursor:grab; }
  .seat:hover { transform: scale(1.05); background: #dbeafe; }
  .seat.dragging { opacity:0.5; transform: scale(1.1); background: #bfdbfe; }
  footer { text-align:center; color:#f0f9ff; margin-bottom:30px; }
  #info { color:#475569; margin-top:10px; font-size:0.9rem; min-height:20px; }
  #vote-section { margin-top:20px; display:none; }
  @media(max-width:600px){.seat{height:70px;font-size:0.9rem;}}
</style>
</head>
<body>
<header>ğŸ’ ìë¦¬ ë°°ì • í”„ë¡œê·¸ë¨</header>
<main>
  <section id="login-section">
    <h2>ë¡œê·¸ì¸</h2>
    <input type="text" id="username" placeholder="ì´ë¦„ ë˜ëŠ” í•™ë²ˆ ì…ë ¥"><br>
    <button onclick="login()">ë¡œê·¸ì¸</button>
  </section>

  <section id="seat-section" style="display:none;">
    <h2 id="welcome"></h2>
    <h3>í•™ìƒ ëª©ë¡ ì…ë ¥ / CSV ì—…ë¡œë“œ</h3>
    <textarea id="studentList" rows="5" placeholder="í•™ìƒ ì´ë¦„ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œ ì…ë ¥"></textarea><br>
    <input type="file" id="csvFile" accept=".csv"><button onclick="loadCSV()">CSV ì—…ë¡œë“œ</button><br>
    
    <h3>ìë¦¬ ë°°ì¹˜ í–‰ x ì—´ ì„¤ì •</h3>
    <input type="number" id="rows" placeholder="í–‰ ìˆ˜" min="1" style="width:35%;"> x 
    <input type="number" id="cols" placeholder="ì—´ ìˆ˜" min="1" style="width:35%;"><br>

    <button onclick="createSeats()">ìë¦¬ ë§Œë“¤ê¸° ğŸª‘</button>
    <button onclick="shuffleWithAnimation()">ìë¦¬ ì„ê¸° ğŸ²</button>
    <button onclick="exportImage()">PNG ì €ì¥ ğŸ“¸</button>
    <button onclick="resetSeats()">ì´ˆê¸°í™” ğŸ”„</button>
    <div id="classroom"></div>
    <div id="info"></div>
    <div id="vote-section">
      <h3>ìë¦¬í‘œë¥¼ ìŠ¹ì¸í• ê¹Œìš”?</h3>
      <button onclick="vote(true)">ì°¬ì„± ğŸ‘</button>
      <button onclick="vote(false)">ë°˜ëŒ€ ğŸ‘</button>
      <div id="vote-info"></div>
    </div>
  </section>
</main>
<footer>Â© 2025 ìë¦¬ ë°°ì • ì‹œìŠ¤í…œ</footer>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
let loggedInUser=null;
let students=[];
let seats=[];
let draggedSeat=null;
let votes={};
let voteSection=document.getElementById("vote-section");

function login(){
  const name=document.getElementById("username").value.trim();
  if(!name) return alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");
  loggedInUser=name;
  document.getElementById("login-section").style.display="none";
  document.getElementById("seat-section").style.display="block";
  document.getElementById("welcome").innerText=`${name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤ ğŸ‘‹`;
  loadSeats();
}

function loadCSV(){
  const file=document.getElementById("csvFile").files[0];
  if(!file) return alert("íŒŒì¼ ì„ íƒ í•„ìš”");
  const reader=new FileReader();
  reader.onload=function(e){
    const text=e.target.result;
    students=text.split("\n").map(s=>s.trim()).filter(s=>s);
    document.getElementById("studentList").value=students.join("\n");
    updateInfo(`${students.length}ëª…ì˜ í•™ìƒ ëª©ë¡ ë¡œë“œ âœ…`);
  };
  reader.readAsText(file,"UTF-8");
}

function createSeats(){
  const list=document.getElementById("studentList").value.trim();
  const rows=parseInt(document.getElementById("rows").value);
  const cols=parseInt(document.getElementById("cols").value);

  if(!list) return alert("í•™ìƒ ëª©ë¡ì„ ì…ë ¥í•˜ì„¸ìš”!");
  if(!rows || !cols) return alert("í–‰ê³¼ ì—´ì„ ì…ë ¥í•˜ì„¸ìš”!");
  students=list.split("\n").map(s=>s.trim()).filter(s=>s);

  if(rows*cols < students.length){
    return alert(`í–‰ x ì—´ì´ í•™ìƒ ìˆ˜ë³´ë‹¤ ì‘ìŠµë‹ˆë‹¤! í•™ìƒ: ${students.length}, ìë¦¬: ${rows*cols}`);
  }

  generateSeats(students, rows, cols);
  updateInfo(`ì´ ${students.length}ëª…ì˜ í•™ìƒ, ${rows}í–‰ x ${cols}ì—´ë¡œ ìë¦¬ ìƒì„± âœ…`);
}

function generateSeats(names, rows, cols){
  const container=document.getElementById("classroom");
  container.innerHTML="";
  container.style.gridTemplateColumns=`repeat(${cols}, 1fr)`;
  seats=[];
  let idx=0;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const seat=document.createElement("div");
      seat.classList.add("seat");
      seat.textContent=names[idx] || ""; // ë¹ˆ ìë¦¬
      seat.draggable=true;
      seat.addEventListener("dragstart",e=>{draggedSeat=seat; seat.classList.add("dragging");});
      seat.addEventListener("dragend",e=>{seat.classList.remove("dragging"); draggedSeat=null; saveSeats();});
      seat.addEventListener("dragover",e=>e.preventDefault());
      seat.addEventListener("drop",e=>{
        e.preventDefault();
        if(draggedSeat && draggedSeat!==seat){
          [seat.textContent, draggedSeat.textContent]=[draggedSeat.textContent, seat.textContent];
          saveSeats();
        }
      });
      seats.push(seat);
      container.appendChild(seat);
      idx++;
    }
  }
  votes={};
  voteSection.style.display="none";
}

function shuffleWithAnimation(){
  if(seats.length===0) return;
  let iterations=5;
  let count=0;
  const info=document.getElementById("info");
  const interval=setInterval(()=>{
    for(let s of seats){
      s.textContent=students[Math.floor(Math.random()*students.length)] || "";
    }
    info.innerText=["ì–´ë–»ê²Œ ë‚˜ì˜¬ê¹Œìš”?","ì ê¹ë§Œìš”...","ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ìš”..."][count%3];
    count++;
    if(count>=iterations){
      clearInterval(interval);
      seats.sort(()=>Math.random()-0.5);
      const container=document.getElementById("classroom");
      container.innerHTML="";
      seats.forEach(s=>container.appendChild(s));
      saveSeats();
      info.innerText="ìë¦¬ ì„ê¸° ì™„ë£Œ! âœ… íˆ¬í‘œë¥¼ ì§„í–‰í•´ì£¼ì„¸ìš”.";
      voteSection.style.display="block";
      votes={};
      document.getElementById("vote-info").innerText="";
    }
  },500);
}

function vote(agree){
  if(!loggedInUser) return;
  votes[loggedInUser]=agree;
  document.getElementById("vote-info").innerText=`í˜„ì¬ íˆ¬í‘œ: ${Object.keys(votes).length}ëª…`;
  const total=students.length;
  const yes=Object.values(votes).filter(v=>v).length;
  if(Object.keys(votes).length===total){
    if(yes>total/2){
      updateInfo("ê³¼ë°˜ìˆ˜ ìŠ¹ì¸! ìë¦¬ í™•ì • âœ…");
      voteSection.style.display="none";
    }else{
      updateInfo("ê³¼ë°˜ìˆ˜ ë¯¸ë‹¬! ìë¦¬ ë‹¤ì‹œ ì„ìŠµë‹ˆë‹¤ ğŸ”„");
      setTimeout(()=>shuffleWithAnimation(),1000);
    }
  }
}

function saveSeats(){
  if(!loggedInUser) return;
  const current=seats.map(s=>s.textContent);
  localStorage.setItem(`seats_${loggedInUser}`, JSON.stringify(current));
  localStorage.setItem(`students_${loggedInUser}`, document.getElementById("studentList").value);
  localStorage.setItem(`grid_${loggedInUser}`, JSON.stringify({rows:document.getElementById("rows").value, cols:document.getElementById("cols").value}));
}

function loadSeats(){
  const saved=localStorage.getItem(`seats_${loggedInUser}`);
  const list=localStorage.getItem(`students_${loggedInUser}`);
  const grid=localStorage.getItem(`grid_${loggedInUser}`);
  if(list) document.getElementById("studentList").value=list;
  if(grid){
    const g=JSON.parse(grid);
    document.getElementById("rows").value=g.rows;
    document.getElementById("cols").value=g.cols;
  }
  if(saved){
    const g=grid ? JSON.parse(grid) : {rows:5, cols:6};
    generateSeats(JSON.parse(saved), g.rows, g.cols);
  }
}

function resetSeats(){
  if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
    localStorage.removeItem(`seats_${loggedInUser}`);
    localStorage.removeItem(`students_${loggedInUser}`);
    localStorage.removeItem(`grid_${loggedInUser}`);
    document.getElementById("studentList").value="";
    document.getElementById("rows").value="";
    document.getElementById("cols").value="";
    document.getElementById("classroom").innerHTML="";
    updateInfo("ìë¦¬ ë°°ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ§¹");
    voteSection.style.display="none";
  }
}

function exportImage(){
  html2canvas(document.getElementById("classroom")).then(canvas=>{
    const link=document.createElement("a");
    link.download="ìë¦¬ë°°ì •.png";
    link.href=canvas.toDataURL();
    link.click();
  });
}

function updateInfo(msg){ document.getElementById("info").innerText=msg; }
</script>
</body>
</html>
